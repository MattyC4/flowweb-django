{% extends "users/base_users.html" %}
{% load static %}
{% block title %}FlowWeb | Iniciar sesión{% endblock %}
{% block content %}
  <h1 class="text-xl font-semibold">Iniciar sesión</h1>

  {% if form.non_field_errors %}
    <div class="mt-3 text-sm rounded-lg border border-red-200 bg-red-50 text-red-700 p-3">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <form method="post" class="mt-5 space-y-4" novalidate>
    {% csrf_token %}

    <!-- Usuario -->
    <div>
      <label for="id_username" class="block text-sm font-medium text-slate-700">Usuario</label>
      <input
        type="text" name="username" id="id_username"
        value="{{ form.username.value|default_if_none:'' }}"
        class="mt-1 w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary"
        autocomplete="username" required>
      {% if form.username.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.username.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Contraseña -->
    <div>
      <label for="id_password" class="block text-sm font-medium text-slate-700">Contraseña</label>
      <div class="mt-1 relative">
        <input
          type="password" name="password" id="id_password"
          class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary pr-10"
          autocomplete="current-password" required>
        <button type="button" id="togglePwd" class="absolute inset-y-0 right-2 my-auto px-2 text-slate-500 text-sm">Mostrar</button>
      </div>
      {% if form.password.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.password.errors|striptags }}</p>
      {% endif %}
    </div>

    <button class="w-full px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark">Entrar</button>

    <div class="flex items-center justify-between text-sm text-slate-600">
      <a href="{% url 'users:password_reset' %}" class="hover:underline">¿Olvidaste tu contraseña?</a>
      <a href="{% url 'users:signup' %}" class="text-primary hover:underline">Crear cuenta</a>
    </div>

    <!-- Acceso demo sin login (opcional) -->
    <a href="{% url 'dashboard:index' %}" class="block w-full text-center px-4 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">
      Entrar en modo demo
    </a>
  </form>

  <script>
    // Toggle de contraseña
    const tp = document.getElementById('togglePwd');
    const ip = document.getElementById('id_password');
    tp?.addEventListener('click', () => {
      const isPwd = ip.type === 'password';
      ip.type = isPwd ? 'text' : 'password';
      tp.textContent = isPwd ? 'Ocultar' : 'Mostrar';
    });
  </script>
{% endblock %}
