{% extends "users/base_users.html" %}
{% load static %}
{% block title %}FlowWeb | Crear cuenta{% endblock %}
{% block content %}
  <h1 class="text-xl font-semibold">Crear cuenta</h1>

  {% if form.non_field_errors %}
    <div class="mt-3 text-sm rounded-lg border border-red-200 bg-red-50 text-red-700 p-3">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <form method="post" class="mt-5 space-y-4" novalidate>
    {% csrf_token %}

    <!-- Username -->
    <div>
      <label for="id_username" class="block text-sm font-medium text-slate-700">Usuario</label>
      <input
        type="text" name="username" id="id_username"
        value="{{ form.username.value|default_if_none:'' }}"
        class="mt-1 w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary"
        autocomplete="username" required>
      {% if form.username.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.username.errors|striptags }}</p>
      {% endif %}
      {% if form.username.help_text %}
        <p class="mt-1 text-xs text-slate-500">{{ form.username.help_text|safe }}</p>
      {% endif %}
    </div>

    <!-- Password1 -->
    <div>
      <label for="id_password1" class="block text-sm font-medium text-slate-700">Contraseña</label>
      <div class="mt-1 relative">
        <input
          type="password" name="password1" id="id_password1"
          class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary pr-10"
          autocomplete="new-password" required>
        <button type="button" id="togglePwd1" class="absolute inset-y-0 right-2 my-auto px-2 text-slate-500 text-sm">Mostrar</button>
      </div>
      {% if form.password1.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.password1.errors|striptags }}</p>
      {% endif %}
      {% if form.password1.help_text %}
        <div class="mt-1 text-xs text-slate-500 space-y-1">{{ form.password1.help_text|safe }}</div>
      {% endif %}
    </div>

    <!-- Password2 -->
    <div>
      <label for="id_password2" class="block text-sm font-medium text-slate-700">Confirmar contraseña</label>
      <div class="mt-1 relative">
        <input
          type="password" name="password2" id="id_password2"
          class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary pr-10"
          autocomplete="new-password" required>
        <button type="button" id="togglePwd2" class="absolute inset-y-0 right-2 my-auto px-2 text-slate-500 text-sm">Mostrar</button>
      </div>
      {% if form.password2.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.password2.errors|striptags }}</p>
      {% endif %}
    </div>

    <button class="w-full px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark">
      Registrarme
    </button>

    <p class="text-sm text-slate-600 mt-2">
      ¿Ya tienes cuenta?
      <a href="{% url 'users:login' %}" class="text-primary hover:underline">Inicia sesión</a>
    </p>
  </form>

  <script>
    // Toggles de contraseña (signup)
    const t1 = document.getElementById('togglePwd1');
    const t2 = document.getElementById('togglePwd2');
    const p1 = document.getElementById('id_password1');
    const p2 = document.getElementById('id_password2');
    t1?.addEventListener('click', () => {
      const isPwd = p1.type === 'password';
      p1.type = isPwd ? 'text' : 'password';
      t1.textContent = isPwd ? 'Ocultar' : 'Mostrar';
    });
    t2?.addEventListener('click', () => {
      const isPwd = p2.type === 'password';
      p2.type = isPwd ? 'text' : 'password';
      t2.textContent = isPwd ? 'Ocultar' : 'Mostrar';
    });
  </script>
{% endblock %}
